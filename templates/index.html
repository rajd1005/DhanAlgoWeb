{% extends "base.html" %}
{% block content %}
<div class="row">
    <div class="col-md-4 mb-3">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">âš¡ Quick Trade ({{ mode }})</div>
            <div class="card-body">
                <form action="/trade" method="POST">
                    
                    <div class="mb-2">
                        <label>Symbol</label>
                        <input type="text" id="symbolSearch" list="symbolList" 
                               class="form-control" placeholder="Type to search (e.g. RELIANCE)" 
                               autocomplete="off" required>
                        <datalist id="symbolList"></datalist>
                        
                        <input type="hidden" name="symbol" id="realSymbol">
                        <input type="hidden" name="security_id" id="securityId"> </div>

                    <div class="mb-2">
                        <label>SL Points</label>
                        <input type="number" name="sl" class="form-control" value="20" required>
                    </div>
                    <button class="btn btn-success w-100">Execute</button>
                </form>
            </div>
        </div>
    </div>
    </div>

<script>
    const input = document.getElementById('symbolSearch');
    const list = document.getElementById('symbolList');
    const realSymbol = document.getElementById('realSymbol');

    input.addEventListener('input', function() {
        const query = this.value;
        if (query.length < 2) return;

        fetch(`/api/search?q=${query}`)
            .then(response => response.json())
            .then(data => {
                list.innerHTML = ''; // Clear old options
                data.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.symbol; // Value shown in box
                    option.innerText = item.display; // Helper text
                    list.appendChild(option);
                });
            });
    });

    // When user selects an option, ensure the hidden value is set
    input.addEventListener('change', function() {
        realSymbol.value = this.value;
    });
</script>
{% endblock %}
